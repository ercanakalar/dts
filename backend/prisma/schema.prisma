generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URI")
}

model Auth {
  id           String  @id @default(uuid())
  email        String? @unique
  tc           String  @unique
  phoneNumber  String  @unique
  password     String
  refreshToken String?
  accessToken  String
  rejectToken  String?
  permit       Permit?
}

model Institution {
  id             String    @id @default(uuid())
  name           String
  address        String
  phoneNumber1   String
  phoneNumber2   String
  institutionKey String
  teachers       Teacher[]
  drivers        Driver[]
  students       Student[]
  permit         Permit[]
}

model Parent {
  id           String  @id @default(uuid())
  authId       String?
  firstName    String
  lastName     String
  tc           String
  address      String
  phoneNumber1 String
  studentId    String
  student      Student @relation(fields: [studentId], references: [id])
}

model Student {
  id             String        @id @default(uuid())
  authId         String?
  firstName      String
  lastName       String
  tc             String
  address        String
  phoneNumber1   String
  phoneNumber2   String
  institutionKey String
  classrooms     Classroom[]
  absentees      Absenteeism[]
  waypoint       Waypoint[]
  institution    Institution?  @relation(fields: [institutionId], references: [id])
  institutionId  String
  parents        Parent[]
}

model Teacher {
  id             String       @id @default(uuid())
  authId         Int
  firstName      String
  lastName       String
  tc             String
  address        String
  phoneNumber1   String
  phoneNumber2   String
  institutionKey String
  classrooms     Classroom[]
  institution    Institution? @relation(fields: [institutionId], references: [id])
  institutionId  String?
}

model Classroom {
  id         String        @id @default(uuid())
  classNo    String
  startClass DateTime
  endClass   DateTime
  classDate  DateTime
  status     String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  absentees  Absenteeism[]
  teacherId  String
  teacher    Teacher       @relation(fields: [teacherId], references: [id])
  studentId  String
  student    Student       @relation(fields: [studentId], references: [id])
}

model Absenteeism {
  id          String     @id @default(uuid())
  classDate   String
  joined      Boolean
  notJoined   Boolean
  totalCount  Int
  studentId   String
  student     Student    @relation(fields: [studentId], references: [id])
  classroomId String?
  classroom   Classroom? @relation(fields: [classroomId], references: [id])
}

model Driver {
  id             String       @id @default(uuid())
  authId         Int
  firstName      String
  lastName       String
  tc             String
  address        String
  phoneNumber1   String
  phoneNumber2   String
  institutionKey String
  routes         Route[]
  institutionId  String?
  institution    Institution? @relation(fields: [institutionId], references: [id])
  waypoint       Waypoint[]
}

model Route {
  id         String   @id @default(uuid())
  waypoints  String
  classDate  DateTime
  classStart DateTime
  driverId   String
  driver     Driver   @relation(fields: [driverId], references: [id])
}

model Waypoint {
  id        String  @id @default(uuid())
  address   String
  lon       Float
  lat       Float
  driverId  String
  driver    Driver  @relation(fields: [driverId], references: [id])
  studentId String
  student   Student @relation(fields: [studentId], references: [id])
}

model Role {
  id       String   @id @default(uuid())
  roleType String
  permit   Permit[]
}

model Permit {
  id            String       @id @default(uuid())
  authId        String?      @unique
  auth          Auth?        @relation(fields: [authId], references: [id])
  roleId        String?
  role          Role?        @relation(fields: [roleId], references: [id])
  institutionId String?
  institution   Institution? @relation(fields: [institutionId], references: [id])
}
